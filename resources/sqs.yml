Resources:
  ClientRoleQueue:
    Type: 'AWS::SQS::Queue'
    Properties:
      QueueName: client_role_queue
      MessageRetentionPeriod: 120


  eventEventRule: 
    Type: AWS::Events::Rule
    Properties:      
      EventPattern: 
        source:
          - "client_rule"
        detail-type:
          - "Client Created"
      Targets: 
        - Arn: !GetAtt ClientRoleQueue.Arn
          Id: "SQSqueue"        

  shipmentEventRule: 
    Type: AWS::Events::Rule
    Properties:      
      EventPattern: 
        source:
          - "shipment_rule"
        detail-type:
          - "Shipment"
      Targets: 
        - Arn: "arn:aws:lambda:us-east-1:550008309007:function:serverless-wolox-develop-CreateShipment"
          Id: "Lambda"

  # Allow EventBridge to invoke SQS
  EventBridgeToToSqsPolicy:
    Type: AWS::SQS::QueuePolicy
    Properties:
      PolicyDocument:
        Statement:
        - Effect: Allow
          Principal:
            Service: events.amazonaws.com
          Action: SQS:SendMessage
          Resource:  !GetAtt ClientRoleQueue.Arn
        - Effect: Allow
          Action: Lambda:Invoke
          Resource: "arn:aws:lambda:us-east-1:550008309007:function:serverless-wolox-develop-CreateShipment"
      Queues:
        - Ref: ClientRoleQueue
